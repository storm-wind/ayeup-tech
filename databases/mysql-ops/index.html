<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="slipstream" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>MySQL Ops - Run That By Me Again</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "MySQL Ops";
        var mkdocs_page_input_path = "databases/mysql-ops.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Run That By Me Again
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Databases</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">MySQL</a>
    <ul class="current">
                <li class="toctree-l2 current"><a class="reference internal current" href="./">MySQL Ops</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#how-to-purge-binary-logs">How to purge binary logs</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../mysql-rep/">Replication</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../mysqlgen/">MYSQL General</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Postgres</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../postgres/">Useful Commands</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Linux</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../linux/ad/">AD</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../linux/bash/">Bash</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../linux/cron/">Cron</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../linux/docker/">Docker</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../linux/filesystems/">FileSystems</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../linux/firewalld/">Firewalld</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../linux/git/">GIT</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../linux/logrotate/">Logrotate</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../linux/lvm/">LVM</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../linux/mail/">Mail</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../linux/nano/">Nano</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../linux/networking/">Networking</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../linux/podman/">Podman</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../linux/raspberry-pi/">Pi</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../linux/redhat/">RHEL</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../linux/swap/">Swap</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../linux/useful/">Useful Commands</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../networks/zerotier/">Zerotier</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Monitoring</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../monitoring/prometheus/">Prometheus</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Windows</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../windows/wsl/">WSL</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../windows/windows/">RDP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../windows/adduserstogroup/">Powershell</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Platforms</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">AWS</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../platforms/awscli/">AWS CLI</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../platforms/awsgen/">AWS Gen</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Azure</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../platforms/azure/">Azure CLI</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Cisco EPNMN</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../platforms/ciscoepnmn/">EPNMN CLI</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Cloudflare</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../platforms/argo/">Argo</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../platforms/proxmox/">Proxmox</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../platforms/vmware/">VMware</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Networks</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">Proxies</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../networks/haproxy/">HAProxy</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../networks/nginx/">Nginx</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Security</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../security/openssl/">openssl</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../networks/stunnel/">Stunnel</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../security/nessus/">Nessus</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../security/selinux/">SElinux</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Run That By Me Again</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Databases &raquo;</li>
          <li>MySQL &raquo;</li>
      <li>MySQL Ops</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="typical-operations-of-mysqlmariadb">Typical Operations of MySQL/MariaDB</h1>
<hr />
<h4 id="how-to-purge-binary-logs">How to purge binary logs</h4>
<pre><code>mysql -u root -p
</code></pre>
<pre><code>SHOW BINARY LOGS;
</code></pre>
<p>and then purge from selectd binary files. Command below will purge logs from last week.</p>
<pre><code>PURGE BINARY LOGS BEFORE DATE(NOW() - INTERVAL 7 DAY) + INTERVAL 0 SECOND;
</code></pre>
<p>You can set binary logs to expire as well. In the <code>/etc/my.cnf</code>.</p>
<pre><code>expire_logs_days = 7;
</code></pre>
<p>To set it without restart MYSQL you can run this,</p>
<pre><code>SET GLOBAL expire_logs_days = 7;
</code></pre>
<p>Also setting max binlog file size as above.</p>
<pre><code>max_binlog_size = 100M
</code></pre>
<pre><code>SET GLOBAL max_binlog_size = 100M;
</code></pre>
<hr />
<h1 id="mysql-replication">MySQL Replication</h1>
<h4 id="show-status-of-secondary-replication-server">Show status of secondary replication server</h4>
<p>Log into MySQL shell and run this,</p>
<pre><code>SHOW SLAVE STATUS \G
</code></pre>
<p>Then you'll see something like this,</p>
<pre><code>MariaDB [(none)]&gt; SHOW SLAVE STATUS \G
*************************** 1. row ***************************
               Slave_IO_State: Waiting for master to send event
                  Master_Host: hostname.example.com
                  Master_User: replication_user
                  Master_Port: 3306
                Connect_Retry: 10
              Master_Log_File: primary1-bin.000198
          Read_Master_Log_Pos: 204348276
               Relay_Log_File: hostname-relay-bin.000043
                Relay_Log_Pos: 204348574
        Relay_Master_Log_File: primary1-bin.000198
             Slave_IO_Running: Yes
            Slave_SQL_Running: Yes
              Replicate_Do_DB:
          Replicate_Ignore_DB:
           Replicate_Do_Table:
       Replicate_Ignore_Table:
      Replicate_Wild_Do_Table:
  Replicate_Wild_Ignore_Table:
                   Last_Errno: 0
                   Last_Error:
                 Skip_Counter: 0
          Exec_Master_Log_Pos: 204348276
              Relay_Log_Space: 204348929
              Until_Condition: None
               Until_Log_File:
                Until_Log_Pos: 0
           Master_SSL_Allowed: No
           Master_SSL_CA_File:
           Master_SSL_CA_Path:
              Master_SSL_Cert:
            Master_SSL_Cipher:
               Master_SSL_Key:
        Seconds_Behind_Master: 0
Master_SSL_Verify_Server_Cert: No
                Last_IO_Errno: 0
                Last_IO_Error:
               Last_SQL_Errno: 0
               Last_SQL_Error:
  Replicate_Ignore_Server_Ids:
             Master_Server_Id: 1
               Master_SSL_Crl:
           Master_SSL_Crlpath:
                   Using_Gtid: No
                  Gtid_IO_Pos:
      Replicate_Do_Domain_Ids:
  Replicate_Ignore_Domain_Ids:
                Parallel_Mode: conservative
                    SQL_Delay: 0
          SQL_Remaining_Delay: NULL
      Slave_SQL_Running_State: Slave has read all relay log; waiting for the slave I/O thread to update it
1 row in set (0.00 sec)

</code></pre>
<hr />
<h4 id="turn-off-gtid">Turn off GTID</h4>
<p>I had to do this as the version I was replicating from was 5.5 to 10.2. 5.5 doesn;t support GTID judging by the errors so I tunred it off.</p>
<pre><code>mysql&gt; stop slave;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; change master to master_auto_position=0;
Query OK, 0 rows affected (0.00 sec)




mysql&gt; change master to master_host='master-1.db.example.com' , master_port = 3306 , master_user = 'replicate' , master_password='welcome' , master_log_file = 'bin_log.000003' , master_log_pos = 191, master_connect_retry = 5;
Query OK, 0 rows affected, 2 warnings (0.00 sec)

mysql&gt; show warnings;
+-------+------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Level | Code | Message                                                                                                                                                                                                                                                                              |
+-------+------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Note  | 1759 | Sending passwords in plain text without SSL/TLS is extremely insecure.                                                                                                                                                                                                               |
| Note  | 1760 | Storing MySQL user name or password information in the master info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START SLAVE; see the 'START SLAVE Syntax' in the MySQL Manual for more information. |
+-------+------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
2 rows in set (0.00 sec)


mysql&gt; start slave;
Query OK, 0 rows affected (0.00 sec)


mysql&gt; SHOW SLAVE STATUS \G

</code></pre>
<p>This will show GTID status still but we can make sure its not using it by running this,</p>
<pre><code>SHOW PROCESSLIST \G
</code></pre>
<p>Look for <strong><em>Command: Binlog Dump</em></strong> which was <strong><em>Command: Binlog Dump GTID</em></strong></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../.." class="btn btn-neutral float-left" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../mysql-rep/" class="btn btn-neutral float-right" title="Replication">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../.." style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../mysql-rep/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
